<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Artikel</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="style.css">

<style>
/* Fade */
.fade-slide{opacity:0;transform:translateY(30px);transition:opacity 0.6s, transform 0.6s}
.fade-slide.visible{opacity:1;transform:translateY(0)}
#gallery img{transition:opacity 0.5s ease-in-out}
.touch-swipe{touch-action:pan-y}

/* === FULLSCREEN VIEWER === */
#fullscreen-viewer {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  backdrop-filter: blur(0.5px);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
#fullscreen-viewer img {
  max-width: 95%;
  max-height: 95%;
  border-radius: 10px;
  box-shadow: 0 0 30px rgba(255,255,255,0.2);
  transition: transform 1s linear;
}
#fullscreen-close {
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 30px;
  color: white;
  cursor: pointer;
  font-weight: bold;
}
</style>
</head>

<body class="bg-gray-900 text-gray-100 transition-colors duration-300">

<!-- FULLSCREEN CONTAINER -->
<div id="fullscreen-viewer">
  <span id="fullscreen-close">âœ•</span>
  <img id="fullscreen-img" src="">
</div>

<header class="sticky top-0 z-30 bg-gray-900 border-b border-gray-700 shadow-md">
  <div class="max-w-5xl mx-auto px-4 py-3 flex justify-between items-center">
    <a href="index.html" class="font-semibold text-lg text-indigo-400">&larr; Kembali</a>
  </div>
</header>

<main class="max-w-5xl mx-auto px-4 py-8">
  <div id="article-container" class="space-y-6">
    <h1 id="title" class="text-3xl font-extrabold fade-slide"></h1>
    <div id="tags" class="flex flex-wrap gap-2 fade-slide"></div>
    <img id="thumb" class="w-full h-64 object-cover rounded-lg shadow-md mt-4 fade-slide" loading="lazy">

    <!-- GALLERY BOX -->
    <div id="gallery-container" class="relative w-full mt-4 rounded-lg overflow-hidden shadow-md touch-swipe fade-slide">
      <div id="gallery" class="relative w-full h-64"></div>
      <button id="prevBtn" class="absolute top-1/2 left-2 transform -translate-y-1/2 bg-indigo-600 text-white rounded-full p-2 hover:bg-indigo-500 transition z-20">&#10094;</button>
      <button id="nextBtn" class="absolute top-1/2 right-2 transform -translate-y-1/2 bg-indigo-600 text-white rounded-full p-2 hover:bg-indigo-500 transition z-20">&#10095;</button>
      <div id="dots" class="absolute bottom-2 left-1/2 transform -translate-x-1/2 flex gap-2"></div>
    </div>

    <!-- 8 BOX DOKUMENTASI -->
    <h2 class="text-2xl font-bold mt-6 fade-slide">Dokumentasi</h2>
    <div id="docs-container" class="grid grid-cols-4 sm:grid-cols-4 gap-3 mt-3 fade-slide"></div>

    <div id="content" class="prose dark:prose-invert max-w-full mt-4 fade-slide"></div>

    <h2 class="text-2xl font-bold mt-6 fade-slide">Sub Bab</h2>
    <div id="sub" class="space-y-6 fade-slide"></div>

    <h2 class="text-2xl font-bold mt-6 fade-slide">File Download</h2>
    <div id="files" class="flex flex-wrap gap-3 mt-2 fade-slide"></div>
  </div>
</main>

<script>
document.addEventListener("DOMContentLoaded",()=>{

  const id = new URLSearchParams(window.location.search).get("id");
  if(!id){
    document.getElementById("article-container").innerHTML="<h2 class='text-center mt-20 text-xl'>Artikel tidak ditemukan</h2>";
    return;
  }

  const script=document.createElement("script");
  script.src=`articles/${id}.js`;
  script.onload=()=>renderArticle();
  script.onerror=()=>document.getElementById("article-container").innerHTML="<h2 class='text-center mt-20 text-xl'>Artikel tidak ditemukan</h2>";
  document.body.appendChild(script);

  function renderArticle(){
    if(!ARTICLE){
      document.getElementById("article-container").innerHTML="<h2 class='text-center mt-20 text-xl'>Artikel tidak ditemukan</h2>";
      return;
    }

    document.getElementById("title").innerText=ARTICLE.title;

    const tagsEl=document.getElementById("tags");
    tagsEl.innerHTML="";
    ARTICLE.tags?.forEach(tag=>{
      const span=document.createElement("span");
      span.className="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-sm dark:bg-indigo-900 dark:text-indigo-200";
      span.textContent=`#${tag}`;
      tagsEl.appendChild(span);
    });

    document.getElementById("thumb").src=ARTICLE.thumbnail;
    document.getElementById("content").innerHTML=ARTICLE.content;

    const subContainer=document.getElementById("sub");
    subContainer.innerHTML="";
    ARTICLE.sub?.forEach(s=>{
      const div=document.createElement("div");
      div.className="sub-section p-4 border-l-4 border-indigo-500 bg-indigo-50 dark:bg-gray-800 rounded-md";
      div.innerHTML=`<h3 class="font-semibold mb-2">${s.subtitle}</h3>${s.body}`;
      subContainer.appendChild(div);
    });

    const fileBox=document.getElementById("files");
    fileBox.innerHTML="";
    ARTICLE.files?.forEach(f=>{
      const a=document.createElement("a");
      a.href=f.url;
      a.download=f.name;
      a.className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition";
      a.textContent=f.name;
      fileBox.appendChild(a);
    });

    /* ===============================
       GALLERY SYSTEM
       =============================== */
    const galleryEl=document.getElementById("gallery");
    const dotsEl=document.getElementById("dots");
    galleryEl.innerHTML="";
    dotsEl.innerHTML="";

    if(ARTICLE.gallery?.length>0){
      let current=0;

      ARTICLE.gallery.forEach((imgSrc,idx)=>{
        const img=document.createElement("img");
        img.src=imgSrc;
        img.className="absolute top-0 left-0 w-full h-64 object-cover cursor-pointer";
        img.style.opacity=idx===0?"1":"0";

        img.addEventListener("click", ()=>openFullscreen(imgSrc));

        galleryEl.appendChild(img);

        const dot=document.createElement("span");
        dot.className=idx===0?"w-3 h-3 rounded-full bg-white":"w-3 h-3 rounded-full bg-gray-400";
        dot.dataset.index=idx;
        dot.addEventListener("click",()=>showSlide(idx));
        dotsEl.appendChild(dot);
      });

      const images=galleryEl.querySelectorAll("img");
      const dots=dotsEl.querySelectorAll("span");

      function showSlide(idx){
        images[current].style.opacity="0";
        dots[current].className="w-3 h-3 rounded-full bg-gray-400";
        current=idx;
        images[current].style.opacity="1";
        dots[current].className="w-3 h-3 rounded-full bg-white";
      }

      document.getElementById("prevBtn").addEventListener("click",()=>showSlide((current-1+images.length)%images.length));
      document.getElementById("nextBtn").addEventListener("click",()=>showSlide((current+1)%images.length));

      let startX=0;
      galleryEl.addEventListener("touchstart",e=>startX=e.touches[0].clientX);
      galleryEl.addEventListener("touchend",e=>{
        let endX=e.changedTouches[0].clientX;
        if(endX-startX>50) document.getElementById("prevBtn").click();
        else if(startX-endX>50) document.getElementById("nextBtn").click();
      });
    }

    /* ==========================================
       === BOX DOKUMENTASI  (8 BOX) ===
       ========================================== */

    const docsContainer=document.getElementById("docs-container");
    docsContainer.innerHTML="";

    const docs = ARTICLE.docs?.length ? ARTICLE.docs : ARTICLE.gallery;

    docs.slice(0,8).forEach(src=>{
      const img=document.createElement("img");
      img.src=src;
      img.className="w-full h-40 object-cover rounded-md cursor-pointer border border-gray-700 hover:border-indigo-500 transition";
      img.addEventListener("click",()=>openFullscreen(src));
      docsContainer.appendChild(img);
    });

    // Fade animation
    document.querySelectorAll('.fade-slide').forEach((el,index)=>{
      el.style.transitionDelay=`${index*0.1}s`;
      new IntersectionObserver((entries,observer)=>{
        entries.forEach(entry=>{
          if(entry.isIntersecting){
            entry.target.classList.add('visible');
            observer.unobserve(entry.target);
          }
        });
      },{threshold:0.1}).observe(el);
    });
  }

  /* ===============================
     === FULLSCREEN IMAGE VIEWER ===
     =============================== */
  const viewer=document.getElementById("fullscreen-viewer");
  const viewerImg=document.getElementById("fullscreen-img");
  const closeBtn=document.getElementById("fullscreen-close");

  function openFullscreen(src){
    viewerImg.src = src;
    viewer.style.display = "flex";
  }

  closeBtn.addEventListener("click", ()=>{
    viewer.style.display = "none";
    resetZoom();
  });

  viewer.addEventListener("click", (e)=>{
    if(e.target === viewer){
      viewer.style.display = "none";
      resetZoom();
    }
  });

  /* ===================================================
     === ZOOM SYSTEM (scroll, pinch, drag, double tap) ===
     =================================================== */

  let scale=1;
  let originX=0;
  let originY=0;
  let isDragging=false;
  let startX=0;
  let startY=0;
  let lastTouchDistance=0;
  let lastTapTime=0;

  function resetZoom(){
    scale=1;
    originX=0;
    originY=0;
    viewerImg.style.transform="translate(0px,0px) scale(1)";
  }

  viewerImg.addEventListener("wheel",(e)=>{
    e.preventDefault();
    const delta=e.deltaY>0?-0.1:0.1;
    scale=Math.min(Math.max(1,scale+delta),5);
    viewerImg.style.transform=`translate(${originX}px,${originY}px) scale(${scale})`;
  });

  viewerImg.addEventListener("mousedown",(e)=>{
    if(scale<=1)return;
    isDragging=true;
    startX=e.clientX-originX;
    startY=e.clientY-originY;
  });

  document.addEventListener("mousemove",(e)=>{
    if(!isDragging)return;
    originX=e.clientX-startX;
    originY=e.clientY-startY;
    viewerImg.style.transform=`translate(${originX}px,${originY}px) scale(${scale})`;
  });

  document.addEventListener("mouseup",()=>isDragging=false);

  viewerImg.addEventListener("touchstart",(e)=>{
    if(e.touches.length===2){
      lastTouchDistance=Math.hypot(
        e.touches[0].clientX-e.touches[1].clientX,
        e.touches[0].clientY-e.touches[1].clientY
      );
    } else if(e.touches.length===1 && scale>1){
      isDragging=true;
      startX=e.touches[0].clientX-originX;
      startY=e.touches[0].clientY-originY;
    }
  });

  viewerImg.addEventListener("touchmove",(e)=>{
    if(e.touches.length===2){
      const newDistance=Math.hypot(
        e.touches[0].clientX-e.touches[1].clientX,
        e.touches[0].clientY-e.touches[1].clientY
      );
      const zoomDelta=(newDistance-lastTouchDistance)*0.005;
      scale=Math.min(Math.max(1,scale+zoomDelta),5);
      lastTouchDistance=newDistance;
      viewerImg.style.transform=`translate(${originX}px,${originY}px) scale(${scale})`;
    }
    if(e.touches.length===1 && isDragging && scale>1){
      originX=e.touches[0].clientX-startX;
      originY=e.touches[0].clientY-startY;
      viewerImg.style.transform=`translate(${originX}px,${originY}px) scale(${scale})`;
    }
  });

  viewerImg.addEventListener("touchend", ()=>{
    isDragging=false;
  });

  viewerImg.addEventListener("touchend",(e)=>{
    const now = Date.now();
    if(now-lastTapTime<300){
      scale = scale === 1 ? 2 : 1;
      originX=0;
      originY=0;
      viewerImg.style.transform=`translate(0px,0px) scale(${scale})`;
    }
    lastTapTime=now;
  });

});
</script>

</body>
</html>
