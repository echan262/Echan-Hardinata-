<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Artikel</title>

<!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="style.css">

<style>
  /* Gallery transition */
  #gallery img {
    transition: opacity 0.5s ease-in-out;
  }
  .touch-swipe {
    touch-action: pan-y;
  }
</style>
</head>
<body class="bg-light text-dark transition-colors duration-300">

<header class="sticky top-0 z-30 bg-white dark:bg-gray-900 border-b border-light dark:border-dark shadow-md">
  <div class="max-w-5xl mx-auto px-4 py-3 flex justify-between items-center">
    <a href="index.html" class="font-semibold text-lg">&larr; Kembali</a>
  </div>
</header>

<main class="max-w-5xl mx-auto px-4 py-8">
  <div id="article-container" class="space-y-6">

    <h1 id="title" class="text-3xl font-extrabold"></h1>
    <div id="tags" class="flex flex-wrap gap-2"></div>

    <!-- Thumbnail -->
    <img id="thumb" class="w-full h-64 object-cover rounded-lg shadow-md mt-4" loading="lazy">

    <!-- Gallery interactive -->
    <div id="gallery-container" class="relative w-full mt-4 rounded-lg overflow-hidden shadow-md touch-swipe">
      <div id="gallery" class="relative w-full h-64"></div>

      <!-- Prev/Next -->
      <button id="prevBtn" class="absolute top-1/2 left-2 transform -translate-y-1/2 bg-gray-700 text-white rounded-full p-2 hover:bg-gray-800 transition z-20">&#10094;</button>
      <button id="nextBtn" class="absolute top-1/2 right-2 transform -translate-y-1/2 bg-gray-700 text-white rounded-full p-2 hover:bg-gray-800 transition z-20">&#10095;</button>

      <!-- Dots indicator -->
      <div id="dots" class="absolute bottom-2 left-1/2 transform -translate-x-1/2 flex gap-2"></div>
    </div>

    <div id="content" class="prose dark:prose-invert max-w-full mt-4"></div>

    <h2 class="text-2xl font-bold mt-6">Sub Bab</h2>
    <div id="sub" class="space-y-6"></div>

    <h2 class="text-2xl font-bold mt-6">File Download</h2>
    <div id="files" class="flex flex-wrap gap-3 mt-2"></div>

  </div>
</main>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const id = new URLSearchParams(window.location.search).get("id");
    if(!id){
        document.getElementById("article-container").innerHTML =
            "<h2 class='text-center mt-20 text-xl'>Artikel tidak ditemukan</h2>";
        return;
    }

    // Load JS artikel dinamis
    const script = document.createElement("script");
    script.src = `articles/${id}.js`;
    script.onload = () => renderArticle();
    script.onerror = () => {
        document.getElementById("article-container").innerHTML =
            "<h2 class='text-center mt-20 text-xl'>Artikel tidak ditemukan</h2>";
    };
    document.body.appendChild(script);

    function renderArticle(){
        if(!ARTICLE){
            document.getElementById("article-container").innerHTML =
                "<h2 class='text-center mt-20 text-xl'>Artikel tidak ditemukan</h2>";
            return;
        }

        document.getElementById("title").innerText = ARTICLE.title;

        // Tags
        const tagsEl = document.getElementById("tags");
        tagsEl.innerHTML = "";
        if(ARTICLE.tags && ARTICLE.tags.length>0){
            ARTICLE.tags.forEach(tag=>{
                const span = document.createElement("span");
                span.className = "px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-sm dark:bg-indigo-900 dark:text-indigo-200";
                span.textContent = `#${tag}`;
                tagsEl.appendChild(span);
            });
        }

        // Thumbnail
        document.getElementById("thumb").src = ARTICLE.thumbnail;

        // Content
        document.getElementById("content").innerHTML = ARTICLE.content;

        // Sub Bab
        const subContainer = document.getElementById("sub");
        subContainer.innerHTML = "";
        if(ARTICLE.sub && ARTICLE.sub.length>0){
            ARTICLE.sub.forEach(s=>{
                const div = document.createElement("div");
                div.className = "sub-section p-4 border-l-4 border-indigo-500 bg-indigo-50 dark:bg-gray-800 rounded-md";
                div.innerHTML = `<h3 class="font-semibold mb-2">${s.subtitle}</h3>${s.body}`;
                subContainer.appendChild(div);
            });
        }

        // File download
        const fileBox = document.getElementById("files");
        fileBox.innerHTML = "";
        if(ARTICLE.files && ARTICLE.files.length>0){
            ARTICLE.files.forEach(f=>{
                const a = document.createElement("a");
                a.href = f.url;
                a.download = f.name;
                a.className = "px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition";
                a.textContent = f.name;
                fileBox.appendChild(a);
            });
        }

        // Interactive gallery
        const galleryEl = document.getElementById("gallery");
        const dotsEl = document.getElementById("dots");
        galleryEl.innerHTML = "";
        dotsEl.innerHTML = "";

        if(ARTICLE.gallery && ARTICLE.gallery.length>0){
            let current = 0;
            ARTICLE.gallery.forEach((imgSrc, idx)=>{
                const img = document.createElement("img");
                img.src = imgSrc;
                img.className = "absolute top-0 left-0 w-full h-64 object-cover";
                img.style.opacity = idx===0 ? "1" : "0";
                galleryEl.appendChild(img);

                // dot
                const dot = document.createElement("span");
                dot.className = idx===0 ? "w-3 h-3 rounded-full bg-white" : "w-3 h-3 rounded-full bg-gray-400";
                dot.dataset.index = idx;
                dot.addEventListener("click", ()=>showSlide(idx));
                dotsEl.appendChild(dot);
            });

            const images = galleryEl.querySelectorAll("img");
            const dots = dotsEl.querySelectorAll("span");

            function showSlide(idx){
                images[current].style.opacity = "0";
                dots[current].className = "w-3 h-3 rounded-full bg-gray-400";
                current = idx;
                images[current].style.opacity = "1";
                dots[current].className = "w-3 h-3 rounded-full bg-white";
            }

            document.getElementById("prevBtn").addEventListener("click", ()=>{
                let idx = (current-1+images.length)%images.length;
                showSlide(idx);
            });
            document.getElementById("nextBtn").addEventListener("click", ()=>{
                let idx = (current+1)%images.length;
                showSlide(idx);
            });

            // Swipe support
            let startX = 0;
            galleryEl.addEventListener("touchstart", e=>{
                startX = e.touches[0].clientX;
            });
            galleryEl.addEventListener("touchend", e=>{
                let endX = e.changedTouches[0].clientX;
                if(endX - startX > 50){
                    // swipe right
                    document.getElementById("prevBtn").click();
                } else if(startX - endX > 50){
                    // swipe left
                    document.getElementById("nextBtn").click();
                }
            });
        }
    }
});
</script>

</body>
</html>
